from flask import Flask, request, jsonify, send_from_directory

app = Flask(__name__, static_folder="static")

@app.route("/")
def home():
    return send_from_directory("static", "index.html")

@app.route("/predict", methods=["POST"])
def predict():
    data = request.get_json(force=True)

    # Support both raw text and structured payload
    if "text" in data:
        text = data["text"]
    else:
        text = f"""
Name: {data.get('name','')}
Status: {data.get('status','')}
Field: {data.get('field','')}
Skills: {data.get('skills','')}
Target Role: {data.get('target','')}
""".strip()

    pred = pipeline.predict([text])[0]
    explanation = explain_prediction(text)

    return jsonify({
        "prediction": pred,
        "explanation": explanation
    })

@app.route("/healthz")
def healthz():
    return "ok", 200

if __name__ == "__main__":
    app.run(host="0.0.0.0", port=8000, debug=False)
